<%- include('../Partials/Adminheader.ejs') %>
<style>
  .rssmaindiv{
    display:none;
  }
  #World,#Main_Feeds,#Cities{
    display: none;
    margin-top:20px;
  }
  body{
    background: url(/app_pics/bg/header.jpg) no-repeat center center fixed;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
  }
  .card {
      position: relative;
      display: -ms-flexbox;
      display: flex;
      -ms-flex-direction: column;
      flex-direction: column;
      min-width: 0;
      word-wrap: break-word;
      background-color: #fff;
      background-clip: border-box;
      border: 1px solid rgba(0, 0, 0, .125);
      border-radius: .65rem;
  }
  .card-body {
      -ms-flex: 1 1 auto;
      flex: 1 1 auto;
      padding: 1.25rem;
  }
  .list-group-item{
    padding:12px;
  }
  .list-group-item.active{
    background: #007BFF !important;
  }
  .badge-light {
    color: rgb(33, 37, 41) !important;
    background-color: rgb(248, 249, 250) !important;
  }
  .badge-warning {
    color: rgb(33, 37, 41) !important;
    background-color: rgb(255, 193, 7) !important;
  }
  .badge {
    display: inline-block !important;
    font-weight: 700 !important;
    line-height: 1 !important;
    text-align: center !important;
    white-space: nowrap !important;
    vertical-align: baseline !important;
    padding: 0.25em 0.4em !important;
    border-radius: 0.25rem !important;
}
</style>
<div class='container side-nav-exist'>
  <div style="margin-top:10px;">
    <div class="col-12 rssmaindiv">
          <div class="card">
              <div class="card-body" id="Main_Feeds">
              </div>

              <div class="card-body" id="Cities">
              </div>

              <div class="card-body" id="Main_Feeds">
              </div>

              <div class="card-body" id="World">
              </div>

          </div>
    </div>

  </div>
</div>
<script src="/Plugins/js/waitme.js"></script>
<script>
$('body').waitMe({
  bg : 'rgba(12, 16, 33,0.6)',
  color : '#fff'
});
getRSSlinks();

function pushDataInDocumnet(data){
  var code = '';
  try{
  code +=' <ul class="list-group" style="margin-top:20px" id="rss'+data._id+'">';
  code +='  <li class="list-group-item active">';
  code +='      <span class="badge badge-light" style="float:left;margin-right:10px">'+data.category+'</span>&nbsp';
  code +='      <span class="badge badge-warning" style="float:left">'+data.subcategory+'</span>';
  code +='      <a onclick="deleteRss(\''+data._id+'\')"><i class="fas fa-trash-alt" style="float:right;color:#fff"></i></a>';
  code +='  </li>';
  code +='  <li class="list-group-item">';
  code +='    <a href="'+data.rssurl+'" target="_blank" style="color: #007bff;font-size: 16px;">'+data.rssurl+'</a>';
  code +='  </li>';
  code +='</ul>';
  } catch(err){
    console.log(err);
  }
  switch (data.category.toLowerCase()) {
    case 'main feeds':
        $('#Main_Feeds').append(code);
        $('#Main_Feeds').css('display','block');
        break;
    case 'cities':
        $('#Cities').append(code);
        $('#Cities').css('display','block');
        break;
    case 'world':
        $('#World').append(code);
        $('#World').css('display','block');
        break;
  }
}
function getRSSlinks(){
  var data = {};
  $.ajax({
        type: 'POST',
        data: JSON.stringify(data),
        contentType: 'application/json',
        url: '/admin/getrsslinks',
        success: function (response) {
          $('body').waitMe("hide");
          if(response.length){
            $('.rssmaindiv').css('display','block');
          }
          for(var i = 0 ; i < response.length ; i++){
            pushDataInDocumnet(response[i]);
          }
        },
        error: function (err) {
          notie.alert({type: 3, text: 'Something went wrong', time: 2})
        }
    });

}

function deleteRss(id){
  $.confirm({
      title: 'Delete RSS Link',
      content: "Are you sure you want to delete this link",
      buttons: {
          'Yes': {
              btnClass: 'btn-success',
              action: function () {
                $('body').css('opacity','0.5');
                var data = {_id:id};
                  $.ajax({
                        type: 'POST',
                        data: JSON.stringify(data),
                        contentType: 'application/json',
                        url: '/admin/removersslinks',
                        success: function (response) {
                          $('#rss'+id).remove();
                          $('body').css('opacity','1');
                          notie.alert({type: 1, text: 'Successfully deleted', time: 2})
                        },
                        error: function (err) {
                          $('body').css('opacity','1');
                          notie.alert({type: 3, text: 'Something went wrong', time: 2})
                        }
                    });
              }
          },
          'No': {btnClass: 'btn-danger',}
      }
  });

}



</script>
